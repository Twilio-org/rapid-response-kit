{% extends 'layout_no_menu.html' %}
{% import 'common.html' as common %}
{% set title = 'Noticeboard' %}

{% block content %}
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script src="//js.pusher.com/2.2/pusher.min.js" type="text/javascript"></script>
  <script type="text/javascript">
    // Enable pusher logging - don't include this in production
    Pusher.log = function(message) {
      if (window.console && window.console.log) {
        window.console.log(message);
      }
    };

    var pusher = new Pusher('{{pusher_key}}');
    var channel = pusher.subscribe('rrk_noticeboard_live');
    channel.bind('new_message', function(data) {
       var old_data = $('#message_container').html();
       var new_data = '<div class="col-sm-4 main center"><img class="noticeboard_img" src="'+ data['image'] + '"><p>'+ data['body']+ '</p><p>Contact '+ data['from']+ ' if you have any information</p></div>';
       $('#message_container').html(old_data + new_data);
       console.log(data);
    });
  </script>
</head>
    <h1>Live Noticeboard</h1>
    <div class="center" id="message_container">
        {% for message in messages %}
        <div class="col-sm-4 main">
            <img class="noticeboard_img" src="{{message.image_url}}">
            <p>{{message.body}}</p>
            <p>Call {{message.from}}</p>
        </div>
        {% endfor %}
    </div>

<style>
.center {
    text-align: center;
}
.noticeboard_img {
    height:300px;
    width:300px;
}
</style>

{% endblock %}
