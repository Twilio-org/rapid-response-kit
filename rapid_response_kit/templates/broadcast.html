{% extends 'layout.html' %}
{% import 'common.html' as common %}
{% set title = 'Broadcast' %}

{% block content %}
    <h1>Broadcast</h1>
    <p>Send one-way communication blast to a group of numbers.</p>
    <form class="form" method="POST">
        <div class="form-group">
            {{ common.twilio_numbers(numbers) }}
        </div>
        <div class="form-group">
            <label for="message" class="control-label">Message</label>
            <textarea id="message" name="message" class="form-control" rows="6" placeholder="Type the message to broadcast."></textarea>
        </div>
        <div class="form-group">
            <label for="numbers" class="control-label">Phone Numbers</label>
            <textarea id="numbers" name="numbers" class="form-control" rows="8" placeholder="Type or paste phone numbers on different lines."></textarea>
        </div>
        <div class="form-group">
            <select id="method" name="method" class="form-control">
                <option value="sms">SMS Message</option>
                <option value="voice">Voice Call</option>
            </select>
        </div>
        <div class="form-group" id="voice">
            {{ common.display_voices(voices) }}
        </div>
        <div class="form-group" id="language">
            <label for="voice-language" class="control-label">Language:</label>
            <select id="voice-language" name="voice-language" class="form-control"></select>
        </div>
        <div class="form-group">
            <button type="submit" class="btn btn-primary btn-lg">Broadcast Message</button>
        </div>
    </form>
{% endblock %}


{% block scripts %}
<script>
    function setLanguages() {
        var $voiceEngine = $("#voice-engine"),
        $voiceLanguage = $("#voice-language"),
        s = '<select id="voice-language" name="voice-language" class="form-control">',
        selectedEngine = $voiceEngine.val(),
        selected = "",
        voices = {{ languages|safe }};

        for(var i = 0, l = voices[selectedEngine].length; i < l; i++) {
                    selected = (voices[selectedEngine][i].default === true) ? "selected " : "";
                    s += "<option " + selected + "value=\"" + voices[selectedEngine][i].value + "\">" + voices[selectedEngine][i].name + "</option>";
        }

        s += "</select>"

        $voiceLanguage.replaceWith(s);
    }

    var $form = $(".form"),
        $say = $("#voice, #language");

    $say.hide();

    $form.on("change", "#method", function() {
        var method = $(this).val();

        if(method === "voice") {
            $say.show();
            setLanguages();
        }
        else {
            $say.hide();
        }
    });

    $form.on("change", "#voice-engine", function() {
        setLanguages();
    });
</script>
{% endblock %}
